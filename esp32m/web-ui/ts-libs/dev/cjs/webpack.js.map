{"version":3,"file":"webpack.js","sourceRoot":"","sources":["../src/webpack.ts"],"names":[],"mappings":";;;;;;AAAA,gDAAwB;AACxB,kFAAiD;AACjD,8EAAoD;AACpD,+DAA0D;AAC1D,4FAA2D;AAC3D,qEAA+D;AAE/D,8EAAoD;AACpD,8DAA8D;AAE9D,qCAQiB;AACjB,8BAA4B;AAC5B,2BAAgC;AAEhC,IAAK,WAIJ;AAJD,WAAK,WAAW;IACd,8BAAe,CAAA;IACf,gCAAiB,CAAA;IACjB,kCAAmB,CAAA;AACrB,CAAC,EAJI,WAAW,KAAX,WAAW,QAIf;AAED,SAAS,aAAa,CAAC,CAAqB;IAC1C,IAAI,CAAC,CAAC;QAAE,OAAO;IACf,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,KAAK,EAAE,WAAW,CAAC,MAAM,EAAE,WAAW,CAAC,OAAO,CAAC,CAAC;IACvE,MAAM,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAgB,CAAC,CAAC;IACtC,IAAI,CAAC,IAAI,CAAC;QAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;AAC1B,CAAC;AAED,IAAK,IAIJ;AAJD,WAAK,IAAI;IACP,qBAAa,CAAA;IACb,mCAA2B,CAAA;IAC3B,iCAAyB,CAAA;AAC3B,CAAC,EAJI,IAAI,KAAJ,IAAI,QAIR;AAED,SAAS,MAAM,CAAC,CAAqB;IACnC,IAAI,CAAC,CAAC;QAAE,OAAO;IACf,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;IACzD,MAAM,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAS,CAAC,CAAC;IAC/B,IAAI,CAAC,IAAI,CAAC;QAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;AAC1B,CAAC;AAED,SAAS,cAAc,CAAC,KAA6B,EAAE,MAAc;IACnE,OAAO,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC;QACzB,CAAC,CAAC,KAAK,CAAC,IAAI,CACR,CAAC,CAAC,EAAE,EAAE,CACJ,CAAC,IAAI,KAAK;YACV,CAAC;YACD,CAAC,CAAC,CAAC,MAAM,IAAI,MAAM;gBACjB,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC;oBACnB,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,IAAI,MAAM,IAAK,CAAS,CAAC,QAAQ,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,CACzE;QACH,CAAC,CAAC,SAAS,CAAC;AAChB,CAAC;AAED,MAAM,qBAAqB,GAAG;IAC5B,IAAI,EAAE,WAAW;IACjB,MAAM,EAAE,uBAAuB;IAC/B,OAAO,EAAE;QACP,MAAM,EAAE,wBAAwB;QAChC,OAAO,EAAE,mDAAmD;KAC7D;CACF,CAAC;AACF,MAAM,oBAAoB,GAAG;IAC3B,IAAI,EAAE,2BAA2B;IACjC,MAAM,EAAE,uBAAuB;IAC/B,OAAO,EAAE;QACP,MAAM,EAAE,uCAAuC;QAC/C,OAAO,EAAE,sCAAsC;KAChD;CACF,CAAC;AACF,MAAM,iBAAiB,GAAG;IACxB,IAAI,EAAE,eAAe;IACrB,MAAM,EAAE,uBAAuB;IAC/B,OAAO,EAAE;QACP,MAAM,EAAE,qBAAqB;QAC7B,OAAO,EAAE,kCAAkC;KAC5C;CACF,CAAC;AACF;;;;;;;IAOI;AACJ,MAAM,oBAAoB,GAAG;IAC3B;QACE,IAAI,EAAE,oBAAoB;QAC1B,MAAM,EAAE,uBAAuB;QAC/B,OAAO,EAAE;YACP,MAAM,EAAE,0BAA0B;YAClC,OAAO,EAAE,oCAAoC;SAC9C;KACF;IACD;QACE,IAAI,EAAE,aAAa;QACnB,MAAM,EAAE,uBAAuB;QAC/B,OAAO,EAAE;YACP,MAAM,EAAE,0BAA0B;YAClC,OAAO,EAAE,oCAAoC;SAC9C;KACF;CACF,CAAC;AACF,MAAM,sBAAsB,GAAG,CAAC,IAAa,EAAE,EAAE,CAAC,CAAC;IACjD,IAAI,EAAE,YAAY;IAClB,MAAM,EAAE,uBAAuB;IAC/B,OAAO,EAAE;QACP,QAAQ,EAAE;YACR;gBACE,MAAM,EAAE,mBAAmB;gBAC3B,OAAO,EAAE,oBAAoB,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,IAAI;aAC3D;YACD;gBACE,MAAM,EAAE,eAAe;gBACvB,OAAO,EAAE,yBAAyB;aACnC;SACF;KACF;CACF,CAAC,CAAC;AAEH,MAAM,iBAAiB,GAAG;IACxB,IAAI,EAAE,mBAAmB;IACzB,IAAI,EAAE,cAAc;IACpB;;;;;;;QAOI;CACL,CAAC;AAEF,MAAM,gBAAgB,GAAG;IACvB,IAAI,EAAE,UAAU;IAChB,IAAI,EAAE,cAAc;CACrB,CAAC;AAKF,MAAa,oBAAoB;IASpB;IARF,UAAU,CAAgB;IAC1B,MAAM,GAAkB,EAAE,CAAC;IAC3B,GAAG,CAAS;IACrB,OAAO,CAAc;IACrB,WAAW,CAA0B;IACrC,YACE,GAAW,EACX,MAAsB,EACb,aAA6B;QAA7B,kBAAa,GAAb,aAAa,CAAgB;QAEtC,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;QAC5C,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,cAAI,CAAC,IAAI,CAAC,GAAG,EAAE,cAAc,CAAC,CAAC,CAAC;IACzD,CAAC;IACD,SAAS,CAAC,MAA+B;QACvC,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC;QAC5B,OAAO,IAAI,CAAC;IACd,CAAC;IACD,aAAa;QACX,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,IAAI,IAAI,CAAC,WAAW,CAAC;IAC9C,CAAC;IACD,YAAY;QACV,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,IAAI,IAAI,CAAC,UAAU,CAAC;IAC7C,CAAC;IACD,aAAa;QACX,MAAM,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC;QAC/B,OAAO,CAAC,MAAM,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;IACtE,CAAC;IACD,aAAa;QACX,MAAM,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC;QAC/B,OAAO,CACL,MAAM,IAAI,MAAM,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CACvE,CAAC;IACJ,CAAC;IACO,UAAU,CAAC,IAAY,EAAE,MAAkC;QACjE,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC;QACtB,SAAS,CAAC;YACR,MAAM,GAAG,GAAG,cAAI,CAAC,OAAO,CAAC,MAAM,EAAE,kBAAkB,IAAI,EAAE,CAAC,CAAC;YAC3D,IAAI,IAAA,eAAU,EAAC,GAAG,CAAC,IAAI,CAAC,CAAC,MAAM,IAAI,MAAM,CAAC,GAAG,CAAC,CAAC;gBAAE,OAAO,GAAG,CAAC;YAC5D,MAAM,MAAM,GAAG,cAAI,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YAC1C,IAAI,MAAM,IAAI,MAAM;gBAAE,MAAM;YAC5B,MAAM,GAAG,MAAM,CAAC;QAClB,CAAC;IACH,CAAC;IACO,gBAAgB;QACtB,IAAI,OAAY,CAAC;QACjB,IAAI,IAAI,CAAC,aAAa,EAAE;YAAE,OAAO,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC;aAC9C,IAAI,IAAI,CAAC,aAAa,EAAE;YAAE,OAAO,GAAG,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC;QAC9D,MAAM,OAAO,GAAe;YAC1B;gBACE,YAAY;gBACZ;oBACE,OAAO,EAAE,KAAK;oBACd,OAAO;iBACR;aACF;YACD,CAAC,mBAAmB,EAAE,EAAE,kBAAkB,EAAE,IAAI,EAAE,CAAC;SACpD,CAAC;QACF,IAAI,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC,OAAO,CAAC;YACtC,OAAO,CAAC,IAAI,CAAC,CAAC,cAAc,EAAE,EAAE,OAAO,EAAE,WAAW,EAAE,CAAC,CAAC,CAAC;QAC3D,MAAM,OAAO,GAAe;YAC1B,CAAC,mCAAmC,EAAE,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC;SAC7D,CAAC;QACF,IAAI,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC,QAAQ,CAAC;YAAE,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAClE,MAAM,IAAI,GAAgB;YACxB,MAAM,EAAE,cAAc;YACtB,OAAO,EAAE;gBACP,OAAO;gBACP,OAAO;aACR;SACF,CAAC;QACF,OAAO;YACL,IAAI,EAAE,SAAS;YACf,OAAO,EAAE,cAAc;YACvB,GAAG,EAAE,CAAC,IAAI,CAAC;SACZ,CAAC;IACJ,CAAC;IACO,WAAW;QACjB,MAAM,EAAE,MAAM,GAAG,EAAE,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;QACxC,MAAM,EAAE,KAAK,GAAG,EAAE,EAAE,GAAG,IAAI,EAAE,GAAG,MAAM,CAAC;QACvC,MAAM,KAAK,GAAkB,EAAE,CAAC;QAChC,MAAM,KAAK,GAAG,cAAc,CAAC,KAAK,EAAE,cAAc,CAAC,CAAC;QACpD,IAAI,CAAC,KAAK;YAAE,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC,CAAC;QAChD,IAAI,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC,SAAS,CAAC,EAAE,CAAC;YAC3C,KAAK,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;QACpC,CAAC;QACD,IAAI,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC;YAC7C,KAAK,CAAC,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC;YACzD,KAAK,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;YACjC,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC/B,CAAC;QACD,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAC9B,KAAK,CAAC,IAAI,CAAC,GAAG,oBAAoB,CAAC,CAAC;QACpC,MAAM,GAAG,GAAG,cAAc,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC;QAChD,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,aAAa,EAAE;YAAE,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAChE,OAAO,EAAE,KAAK,EAAE,CAAC,GAAG,KAAK,EAAE,GAAG,KAAK,CAAC,EAAE,GAAG,IAAI,EAAE,CAAC;IAClD,CAAC;IACO,iBAAiB;QACvB,MAAM,EAAE,YAAY,GAAG,EAAE,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;QAC9C,MAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;QACrC,MAAM,SAAS,GAAG;YAChB,IAAI,+BAAY,CAAC;gBACf,QAAQ,EAAE,IAAI;gBACd,aAAa,EAAE;oBACb,eAAe,EAAE,aAAa;oBAC9B,WAAW,EAAE,aAAa;oBAC1B,MAAM,EAAE,EAAE,QAAQ,EAAE,KAAK,EAAE;iBAC5B;aACF,CAAC;SACH,CAAC;QACF,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAG,YAAY,EAAE,CAAC;IAClD,CAAC;IACO,gBAAgB;QACtB,MAAM,EAAE,WAAW,GAAG,EAAE,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;QAC7C,MAAM,KAAK,GAAG,EAAE,GAAG,IAAI,GAAG,IAAI,CAAC;QAC/B,OAAO,EAAE,iBAAiB,EAAE,KAAK,EAAE,YAAY,EAAE,KAAK,EAAE,GAAG,WAAW,EAAE,CAAC;IAC3E,CAAC;IACO,YAAY;QAClB,MAAM,EAAE,OAAO,GAAG,EAAE,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;QACzC,MAAM,KAAK,GAAwB,IAAI,CAAC,aAAa,EAAE;YACrD,CAAC,CAAC,EAAE,YAAY,EAAE,yBAAyB,EAAE;YAC7C,CAAC,CAAC;gBACE,EAAE,EAAE,KAAK;gBACT,EAAE,EAAE,KAAK;gBACT,IAAI,EAAE,KAAK;gBACX,OAAO,EAAE,KAAK;gBACd,EAAE,EAAE,KAAK;gBACT,OAAO,EAAE,KAAK;gBACd,KAAK,EAAE,KAAK;gBACZ,YAAY,EAAE,KAAK;gBACnB,mBAAmB,EAAE,KAAK;gBAC1B,4BAA4B,EAAE,KAAK;aACpC,CAAC;QACN,4FAA4F;QAC5F,IAAI,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC,WAAW,CAAC;YAC1C,KAAK,CAAC,SAAS,CAAC,GAAG,gBAAgB,CAAC;QACtC,MAAM,UAAU,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;QAClD;;iDAEyC;QACzC,OAAO,EAAE,UAAU,EAAE,KAAK,EAAE,GAAG,OAAO,EAAE,CAAC;IAC3C,CAAC;IACO,eAAe;QACrB,MAAM,gBAAgB,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC;QACpE,OAAO,IAAI,sBAAY,CAAC;YACtB,CAAC,GAAG,gBAAgB,eAAe,CAAC,EAAE;gBACpC,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC;gBAC7C,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;gBAC/C,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;gBACtC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC;aAC9C;YACD,GAAG,MAAM,CAAC,WAAW,CACnB,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE,OAAO,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC;gBAChE,GAAG,gBAAgB,IAAI,CAAC,EAAE;gBAC1B,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;aAClB,CAAC,CACH;SACF,CAAC,CAAC;IACL,CAAC;IACO,YAAY;QAClB,MAAM,EAAE,OAAO,GAAG,EAAE,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;QACzC,MAAM,SAAS,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;QACzC,MAAM,MAAM,GAAiC,CAAC,SAAS,CAAC,CAAC;QACzD,IAAI,IAAI,CAAC,aAAa,EAAE,EAAE,CAAC;YACzB,MAAM,CAAC,IAAI,CACT,IAAI,6BAAiB,CAAC;gBACpB,KAAK,EAAE,KAAK;gBACZ,QAAQ,EAAE,gBAAgB;aAC3B,CAAC,CACH,CAAC;YACF,IAAI,IAAI,CAAC,YAAY,EAAE;gBACrB,MAAM,CAAC,IAAI,CACT,IAAI,yCAAkB,CAAC,EAAE,CAAC,EAC1B,IAAI,oCAAiB,CAAC;oBACpB,IAAI,EAAE,sBAAsB;oBAC5B,SAAS,EAAE,MAAM;iBAClB,CAAC,CACH,CAAC;QACN,CAAC;QACD,IAAI,IAAI,CAAC,aAAa,EAAE,EAAE,CAAC;YACzB,MAAM,CAAC,IAAI,CACT,IAAI,kBAAQ,CAAC,qBAAqB,CAAC;gBACjC,SAAS,EAAE,CAAC;aACb,CAAC,CACH,CAAC;YACF,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC,CAAC,EAAE,EAAE,CACtD,IAAA,eAAU,EAAC,cAAI,CAAC,OAAO,CAAC,CAAC,EAAE,0BAA0B,CAAC,CAAC,CACxD,CAAC;YACF,IAAI,UAAU;gBACZ,MAAM,CAAC,IAAI,CACT,IAAI,6BAAiB,CAAC;oBACpB,QAAQ,EAAE;wBACR;4BACE,IAAI,EAAE,cAAI,CAAC,OAAO,CAAC,UAAU,EAAE,0BAA0B,CAAC;4BAC1D,EAAE,EAAE,cAAI,CAAC,OAAO,CACd,IAAI,CAAC,GAAG,EACR,oCAAoC,CACrC;yBACF;qBACF;iBACF,CAAC,CACH,CAAC;QACN,CAAC;QACD,IAAI,IAAI,CAAC,WAAW,IAAI,WAAW,CAAC,OAAO;YACzC,MAAM,CAAC,IAAI,CACT,IAAI,8CAAoB,EAAsC,CAC/D,CAAC;QACJ,OAAO,CAAC,GAAG,MAAM,EAAE,GAAG,OAAO,CAAC,CAAC;IACjC,CAAC;IACO,WAAW;QACjB,MAAM,EAAE,MAAM,GAAG,EAAE,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;QACxC,MAAM,CAAC,GAAG,cAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;QACzC,OAAO,EAAE,IAAI,EAAE,CAAC,EAAE,UAAU,EAAE,GAAG,EAAE,GAAG,MAAM,EAAE,CAAC;IACjD,CAAC;IACD,KAAK;QACH,OAAO,CAAC,GAA2B,EAAE,IAA4B,EAAE,EAAE;YACnE,IAAI,CAAC,WAAW,GAAG,aAAa,CAC9B,GAAG,CAAC,WAAW,IAAI,GAAG,CAAC,WAAW,IAAI,OAAO,CAAC,GAAG,CAAC,WAAW,CAC9D,CAAC;YACF,MAAM,EACJ,IAAI,GAAG,MAAM,CAAC,GAAG,CAAC,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,EACnD,MAAM,EACN,KAAK,GAAG;gBACN,IAAI,EAAE,CAAC,cAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,cAAc,CAAC,CAAC;aAC5C,GACF,GAAG,IAAI,CAAC,UAAU,CAAC;YACpB,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE;gBACzB,IAAI;gBACJ,MAAM;gBACN,KAAK;aACN,CAAC,CAAC;YAEH,MAAM,EACJ,OAAO,GAAG,IAAI,CAAC,aAAa,EAAE;gBAC5B,CAAC,CAAC,mBAAmB;gBACrB,CAAC,CAAC,IAAI,CAAC,YAAY,EAAE;oBACnB,CAAC,CAAC,SAAS;oBACX,CAAC,CAAC,SAAS,EACf,SAAS,GAAG,IAAI,CAAC,aAAa,EAAE;gBAC9B,CAAC,CAAC;oBACE,kBAAkB,EAAE,IAAI;oBACxB,IAAI,EAAE,IAAI;iBACX;gBACH,CAAC,CAAC,SAAS,GACd,GAAG,IAAI,CAAC,UAAU,CAAC;YACpB,MAAM,QAAQ,GAAG,EAAE,OAAO,EAAE,SAAS,EAAE,CAAC;YACxC,MAAM,KAAK,GAAG;gBACZ,MAAM,EAAE,IAAI,CAAC,WAAW,EAAE;gBAC1B,YAAY,EAAE,IAAI,CAAC,iBAAiB,EAAE;gBACtC,WAAW,EAAE,IAAI,CAAC,gBAAgB,EAAE;gBACpC,OAAO,EAAE,IAAI,CAAC,YAAY,EAAE;gBAC5B,OAAO,EAAE,IAAI,CAAC,YAAY,EAAE;gBAC5B,MAAM,EAAE,IAAI,CAAC,WAAW,EAAE;aAC3B,CAAC;YACF,OAAO,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,UAAU,EAAE,QAAQ,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;QAC1E,CAAC,CAAC;IACJ,CAAC;CACF;AAlQD,oDAkQC;AAED,SAAgB,UAAU,CACxB,GAAW,EACX,GAA4B,EAC5B,IAA6B;IAE7B,MAAM,MAAM,GAAG,IAAI,oBAAoB,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,CAAC;IACrD,MAAM,OAAO,GAAG,IAAA,iBAAO,EAAC,MAAM,CAAC,GAAG,IAAI,EAAE,EAAE,IAAI,IAAI,EAAE,CAAC,CAAC,CAAC;IACvD,OAAO,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE;QAClB,IAAI,GAAG,EAAE,CAAC;YACR,OAAO,CAAC,GAAG,CAAC,6CAA6C,EAAE,GAAG,CAAC,CAAC;QAClE,CAAC;IACH,CAAC,CAAC,CAAC;AACL,CAAC;AAZD,gCAYC","sourcesContent":["import path from 'path';\r\nimport TerserPlugin from 'terser-webpack-plugin';\r\nimport HtmlWebpackPlugin from 'html-webpack-plugin';\r\nimport { CleanWebpackPlugin } from 'clean-webpack-plugin';\r\nimport CompressionPlugin from 'compression-webpack-plugin';\r\nimport { BundleAnalyzerPlugin } from 'webpack-bundle-analyzer';\r\nimport { PackageJson } from 'types-package-json';\r\nimport CopyWebpackPlugin from 'copy-webpack-plugin';\r\n//import WebpackStringReplacer from 'webpack-string-replacer';\r\n\r\nimport {\r\n  ModuleOptions,\r\n  RuleSetRule,\r\n  Configuration,\r\n  DefinePlugin,\r\n  webpack,\r\n  optimize,\r\n  WebpackPluginInstance,\r\n} from 'webpack';\r\nimport 'webpack-dev-server';\r\nimport { existsSync } from 'fs';\r\n\r\nenum Destination {\r\n  Local = 'local',\r\n  Remote = 'remote',\r\n  Analyze = 'analyze',\r\n}\r\n\r\nfunction ToDestination(v: string | undefined): Destination | undefined {\r\n  if (!v) return;\r\n  const a = [Destination.Local, Destination.Remote, Destination.Analyze];\r\n  const i = a.indexOf(v as Destination);\r\n  if (i >= 0) return a[i];\r\n}\r\n\r\nenum Mode {\r\n  None = 'none',\r\n  Development = 'development',\r\n  Production = 'production',\r\n}\r\n\r\nfunction ToMode(v: string | undefined): Mode | undefined {\r\n  if (!v) return;\r\n  const a = [Mode.None, Mode.Development, Mode.Production];\r\n  const i = a.indexOf(v as Mode);\r\n  if (i >= 0) return a[i];\r\n}\r\n\r\nfunction findModuleRule(rules: ModuleOptions['rules'], loader: string) {\r\n  return Array.isArray(rules)\r\n    ? rules.find(\r\n        (r) =>\r\n          r != '...' &&\r\n          r &&\r\n          (r.loader == loader ||\r\n            (Array.isArray(r.use) &&\r\n              r.use.some((u) => u == loader || (u as any)['loader'] == loader)))\r\n      )\r\n    : undefined;\r\n}\r\n\r\nconst expressViewsFixLoader = {\r\n  test: /view\\.js$/,\r\n  loader: 'string-replace-loader',\r\n  options: {\r\n    search: 'require(mod).__express',\r\n    replace: 'function() { throw \"views are not implemented\"; }',\r\n  },\r\n};\r\nconst ssdpOptionsFixLoader = {\r\n  test: /default-ssdp-options\\.js$/,\r\n  loader: 'string-replace-loader',\r\n  options: {\r\n    search: \"const pkg = req('../../package.json')\",\r\n    replace: \"import pkg from '../../package.json'\",\r\n  },\r\n};\r\nconst bindingsFixLoader = {\r\n  test: /bindings\\.js$/,\r\n  loader: 'string-replace-loader',\r\n  options: {\r\n    search: 'opts.module_root = ',\r\n    replace: 'opts.module_root = __dirname; //',\r\n  },\r\n};\r\n/*const nodeGypFixLoader = {\r\n  test: /node-gyp-build\\.js$/,\r\n  loader: 'string-replace-loader',\r\n  options: {\r\n    search: /path\\.join\\(dir, 'prebuilds'/g,\r\n    replace: \"path.join(__dirname, 'prebuilds'\",\r\n  },\r\n};*/\r\nconst serialportFixLoaders = [\r\n  {\r\n    test: /load-bindings\\.js$/,\r\n    loader: 'string-replace-loader',\r\n    options: {\r\n      search: /\\(__dirname, '\\.\\.\\/'\\)/g,\r\n      replace: \"(__dirname, './native/serialport')\",\r\n    },\r\n  },\r\n  {\r\n    test: /poller\\.js$/,\r\n    loader: 'string-replace-loader',\r\n    options: {\r\n      search: /\\(__dirname, '\\.\\.\\/'\\)/g,\r\n      replace: \"(__dirname, './native/serialport')\",\r\n    },\r\n  },\r\n];\r\nconst ipfsUtilsHttpFixLoader = (node: boolean) => ({\r\n  test: /fetch\\.js$/,\r\n  loader: 'string-replace-loader',\r\n  options: {\r\n    multiple: [\r\n      {\r\n        search: 'require(implName)',\r\n        replace: `require('./fetch.${node ? 'node' : 'browser'}')`,\r\n      },\r\n      {\r\n        search: 'require(impl)',\r\n        replace: \"require('native-fetch')\",\r\n      },\r\n    ],\r\n  },\r\n});\r\n\r\nconst inlineImageLoader = {\r\n  test: /\\.(png|jpg|gif)$/i,\r\n  type: 'asset/inline',\r\n  /*use: [\r\n    {\r\n      loader: 'url-loader',\r\n      options: {\r\n        limit: 8192,\r\n      },\r\n    },\r\n  ],*/\r\n};\r\n\r\nconst inlineJsonLoader = {\r\n  test: /\\.json$/i,\r\n  type: 'asset/source',\r\n};\r\n\r\ntype BuilderConfig = {\r\n  defines?: Record<string, any>;\r\n};\r\nexport class WebpackConfigBuilder {\r\n  readonly baseConfig: Configuration;\r\n  readonly config: Configuration = {};\r\n  readonly dir: string;\r\n  package: PackageJson;\r\n  destination: Destination | undefined;\r\n  constructor(\r\n    dir: string,\r\n    config?: Configuration,\r\n    readonly builderConfig?: BuilderConfig\r\n  ) {\r\n    this.dir = dir;\r\n    this.baseConfig = Object.assign({}, config);\r\n    this.package = require(path.join(dir, 'package.json'));\r\n  }\r\n  setTarget(target: Configuration['target']) {\r\n    this.config.target = target;\r\n    return this;\r\n  }\r\n  isDevelopment() {\r\n    return this.config.mode == Mode.Development;\r\n  }\r\n  isProduction() {\r\n    return this.config.mode == Mode.Production;\r\n  }\r\n  hasWebTargets() {\r\n    const { target } = this.config;\r\n    return !target || (Array.isArray(target) && target.includes('web'));\r\n  }\r\n  hasNodeTarget() {\r\n    const { target } = this.config;\r\n    return (\r\n      target == 'node' || (Array.isArray(target) && target.includes('node'))\r\n    );\r\n  }\r\n  private findModule(name: string, tester?: (path: string) => boolean) {\r\n    let curdir = this.dir;\r\n    for (;;) {\r\n      const dir = path.resolve(curdir, `./node_modules/${name}`);\r\n      if (existsSync(dir) && (!tester || tester(dir))) return dir;\r\n      const parent = path.resolve(curdir, '..');\r\n      if (parent == curdir) break;\r\n      curdir = parent;\r\n    }\r\n  }\r\n  private buildBabelLoader() {\r\n    let targets: any;\r\n    if (this.hasNodeTarget()) targets = { node: true };\r\n    else if (this.hasWebTargets()) targets = { browsers: '> 5%' };\r\n    const presets: Array<any> = [\r\n      [\r\n        '@babel/env',\r\n        {\r\n          modules: false,\r\n          targets,\r\n        },\r\n      ],\r\n      ['@babel/typescript', { optimizeConstEnums: true }],\r\n    ];\r\n    if (this.package.dependencies?.['react'])\r\n      presets.push(['@babel/react', { runtime: 'automatic' }]);\r\n    const plugins: Array<any> = [\r\n      ['@babel/plugin-proposal-decorators', { version: 'legacy' }],\r\n    ];\r\n    if (this.package.dependencies?.['lodash']) plugins.push('lodash');\r\n    const rule: RuleSetRule = {\r\n      loader: 'babel-loader',\r\n      options: {\r\n        presets,\r\n        plugins,\r\n      },\r\n    };\r\n    return {\r\n      test: /\\.tsx?$/,\r\n      exclude: /node_modules/,\r\n      use: [rule],\r\n    };\r\n  }\r\n  private buildModule() {\r\n    const { module = {} } = this.baseConfig;\r\n    const { rules = [], ...rest } = module;\r\n    const built: RuleSetRule[] = [];\r\n    const babel = findModuleRule(rules, 'babel-loader');\r\n    if (!babel) built.push(this.buildBabelLoader());\r\n    if (this.package.dependencies?.['express']) {\r\n      built.push(expressViewsFixLoader);\r\n    }\r\n    if (this.package.dependencies?.['ipfs-core']) {\r\n      built.push(ipfsUtilsHttpFixLoader(this.hasNodeTarget()));\r\n      built.push(ssdpOptionsFixLoader);\r\n      built.push(inlineJsonLoader);\r\n    }\r\n    built.push(bindingsFixLoader);\r\n    built.push(...serialportFixLoaders);\r\n    const url = findModuleRule(rules, 'url-loader');\r\n    if (!url && this.hasWebTargets()) built.push(inlineImageLoader);\r\n    return { rules: [...rules, ...built], ...rest };\r\n  }\r\n  private buildOptimization() {\r\n    const { optimization = {} } = this.baseConfig;\r\n    const minimize = this.isProduction();\r\n    const minimizer = [\r\n      new TerserPlugin({\r\n        parallel: true,\r\n        terserOptions: {\r\n          keep_classnames: /AbortSignal/,\r\n          keep_fnames: /AbortSignal/,\r\n          output: { comments: false },\r\n        },\r\n      }),\r\n    ];\r\n    return { minimize, minimizer, ...optimization };\r\n  }\r\n  private buildPerformance() {\r\n    const { performance = {} } = this.baseConfig;\r\n    const limit = 16 * 1024 * 1024;\r\n    return { maxEntrypointSize: limit, maxAssetSize: limit, ...performance };\r\n  }\r\n  private buildResolve() {\r\n    const { resolve = {} } = this.baseConfig;\r\n    const alias: Record<string, any> = this.hasNodeTarget()\r\n      ? { 'node-fetch': 'node-fetch/lib/index.js' }\r\n      : {\r\n          os: false,\r\n          fs: false,\r\n          path: false,\r\n          express: false,\r\n          ws: false,\r\n          winston: false,\r\n          debug: false,\r\n          'express-ws': false,\r\n          'node-localstorage': false,\r\n          'redux-persist-node-storage': false,\r\n        };\r\n    //    const fallback=this.hasNodeTarget()?{}:{crypto: require.resolve('crypto-browserify')};\r\n    if (this.package.dependencies?.['puppeteer'])\r\n      alias['pkg-dir'] = '@ts-libs/stubs';\r\n    const extensions = ['.tsx', '.ts', '.js', '.jsx'];\r\n    /*    const mainFields = this.hasNodeTarget()\r\n      ? {}\r\n      : { mainFields: ['main', 'module'] };*/\r\n    return { extensions, alias, ...resolve };\r\n  }\r\n  private buildInfoPlugin() {\r\n    const globalObjectName = this.hasNodeTarget() ? 'global' : 'window';\r\n    return new DefinePlugin({\r\n      [`${globalObjectName}.__build_info`]: {\r\n        version: JSON.stringify(this.package.version),\r\n        built: JSON.stringify(new Date().toISOString()),\r\n        mode: JSON.stringify(this.config.mode),\r\n        destination: JSON.stringify(this.destination),\r\n      },\r\n      ...Object.fromEntries(\r\n        Object.entries(this.builderConfig?.defines || {}).map(([k, v]) => [\r\n          `${globalObjectName}.${k}`,\r\n          JSON.stringify(v),\r\n        ])\r\n      ),\r\n    });\r\n  }\r\n  private buildPlugins() {\r\n    const { plugins = [] } = this.baseConfig;\r\n    const buildInfo = this.buildInfoPlugin();\r\n    const result: Array<WebpackPluginInstance> = [buildInfo];\r\n    if (this.hasWebTargets()) {\r\n      result.push(\r\n        new HtmlWebpackPlugin({\r\n          title: 'app',\r\n          template: 'src/index.html',\r\n        })\r\n      );\r\n      if (this.isProduction())\r\n        result.push(\r\n          new CleanWebpackPlugin({}),\r\n          new CompressionPlugin({\r\n            test: /\\.(js|css|html|svg)$/,\r\n            algorithm: 'gzip',\r\n          })\r\n        );\r\n    }\r\n    if (this.hasNodeTarget()) {\r\n      result.push(\r\n        new optimize.LimitChunkCountPlugin({\r\n          maxChunks: 1,\r\n        })\r\n      );\r\n      const serialPort = this.findModule('@serialport', (p) =>\r\n        existsSync(path.resolve(p, './bindings-cpp/prebuilds'))\r\n      );\r\n      if (serialPort)\r\n        result.push(\r\n          new CopyWebpackPlugin({\r\n            patterns: [\r\n              {\r\n                from: path.resolve(serialPort, './bindings-cpp/prebuilds'),\r\n                to: path.resolve(\r\n                  this.dir,\r\n                  './dist/native/serialport/prebuilds'\r\n                ),\r\n              },\r\n            ],\r\n          })\r\n        );\r\n    }\r\n    if (this.destination == Destination.Analyze)\r\n      result.push(\r\n        new BundleAnalyzerPlugin() as unknown as WebpackPluginInstance\r\n      );\r\n    return [...result, ...plugins];\r\n  }\r\n  private buildOutput() {\r\n    const { output = {} } = this.baseConfig;\r\n    const p = path.resolve(this.dir, 'dist');\r\n    return { path: p, publicPath: '/', ...output };\r\n  }\r\n  build() {\r\n    return (env: Record<string, string>, argv: Record<string, string>) => {\r\n      this.destination = ToDestination(\r\n        env.DESTINATION || env.destination || process.env.DESTINATION\r\n      );\r\n      const {\r\n        mode = ToMode(env.NODE_ENV || process.env.NODE_ENV),\r\n        target,\r\n        entry = {\r\n          main: [path.join(this.dir, 'src/index.ts')],\r\n        },\r\n      } = this.baseConfig;\r\n      Object.assign(this.config, {\r\n        mode,\r\n        target,\r\n        entry,\r\n      });\r\n\r\n      const {\r\n        devtool = this.isDevelopment()\r\n          ? 'inline-source-map'\r\n          : this.isProduction()\r\n            ? undefined\r\n            : undefined,\r\n        devServer = this.hasWebTargets()\r\n          ? {\r\n              historyApiFallback: true,\r\n              port: 9000,\r\n            }\r\n          : undefined,\r\n      } = this.baseConfig;\r\n      const inferred = { devtool, devServer };\r\n      const built = {\r\n        module: this.buildModule(),\r\n        optimization: this.buildOptimization(),\r\n        performance: this.buildPerformance(),\r\n        resolve: this.buildResolve(),\r\n        plugins: this.buildPlugins(),\r\n        output: this.buildOutput(),\r\n      };\r\n      return Object.assign({}, this.baseConfig, inferred, this.config, built);\r\n    };\r\n  }\r\n}\r\n\r\nexport function runWebpack(\r\n  dir: string,\r\n  env?: Record<string, string>,\r\n  argv?: Record<string, string>\r\n) {\r\n  const config = new WebpackConfigBuilder(dir).build();\r\n  const bundler = webpack(config(env || {}, argv || {}));\r\n  bundler.run((err) => {\r\n    if (err) {\r\n      console.log('Webpack compiler encountered a fatal error.', err);\r\n    }\r\n  });\r\n}\r\n"]}